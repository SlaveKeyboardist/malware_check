# malware_check
This was created with chatgpt-4o and this is intended to check for hacks such as the one described in this reddit thread (https://www.reddit.com/r/comfyui/comments/1dbls5n/psa_if_youve_used_the_comfyui_llmvision_node_from/)

I am not responsible for anything that happens if you run this code.

You should always review unkown code before running it.

Simply copy this script into the base directory of your project and run with the following command after activating any virtual environment and it will preform some checks and output files that may need additional checks.

python malware_check.py


In case that thread dissappears it the following is the content from that post.

 PSA: If you've used the ComfyUI_LLMVISION node from u/AppleBotzz, you've been hacked

I've blocked the user so they can't see this post to give you time to address this if you've been compromised.

Long story short, if you've installed and used that node, your browser passwords, credit card info, and browsing history have been sent to a Discord server via webhook.

I've been personally affected by this. About a week after I installed this package, I got a ton of malicious login notifications on a bunch of services, so I'm absolutely sure that they're actively using this data.

Here's how to verify:

The custom node has custom wheels for the OpenAI and Anthropic libraries in requirements.txt. Inside those wheels are malicious code. You can download the wheels and unzip to see what's inside.

If you have the wheel labeled 1.16.2 installed:

    it's actually installing 1.16.3, which doesn't exist. There is no 1.16.3 â€” the release history goes from 1.16.2 to 1.17. https://pypi.org/project/openai/#history

    Inside that package, you'll find /lib/browser/admin.py. This file reads your browser data and stores it in your temp directory in a subdirectory with the format pre_XXXXX_suf. Inside, you'll find C.txt and F.txt, corresponding to Chrome or Firefox data.

    The file contains an encrypted string. When you decrypt, it points to a Discord webhook: https://discord.com/api/webhooks/1226397926067273850/8DRvc59pUs0E0SuVGJXJUJSwD_iEjQUhq-G1iFoe6DjDv6Y3WiQJMQONetAokJD2nwym

    This file is sending your data to that webhook.

If you have 1.30.2 installed:

    Again, it's compromised. You'll find openai/_OAI.py. Inside are two encrypted strings that are Pastebin links. I won't paste them here so you don't accidentally download the files...

    The first Pastebin link contains another encrypted string that, when decrypted, points to another Discord webhook: https://discord.com/api/webhooks/1243343909526962247/zmZbH3D5iMWsfDlbBIauVHc2u8bjMUSlYe4cosNfnV5XIP2ql-Q37hHBCI8eeteib2aB

    The second contains the URL for a presumably malicious file, VISION-D.exe. The script downloads and runs that file.

    From looking at the rest of the code, it looks like the code is creating a registry entry, as well as stealing API keys and sending them to the Discord webhook.

Here's how to tell if you've been affected:

    Check C:\Users\YourUser\AppData\Local\Temp. Look for directories with the format pre_XXXX_suf. Inside, check for a C.txt and F.txt. If so, your data has been compromised.

    Check python_embedded\site-packages for the following packages. If you have any installed, your data has been compromised. Note that the latter two look like legitimate distributions. Check for the files I referenced above.

        openai-1.16.3.dist-info

        anthropic-0.21.4.dist-info

        openai-1.30.2.dist-info

        anthropic-0.26.1.dist-info

    Check your Windows registry under HKEY_CURRENT_USER\Software\OpenAICLI. You're looking for FunctionRun with a value of 1. If it's set, you've been compromised.

Here's how to clean it up:

At least, from what I can tell... There may be more going on.

    Remove the packages listed above.

    Search your filesystem for any references to the following files and remove them:

        lib/browser/admin.py

        Cadmino. py

        Fadmino. py

        VISION-D.exe

    Check your Windows registry for the key listed above and remove it.

    Run a malware scanner. Mine didn't catch this.

    Change all of your passwords, everywhere.

    F*** that guy.

 Before you assume that this was an innocent mistake, u/applebotzz updated this code twice, making the code harder to spot the second time. This was deliberate.

From now on, I'll be carefully checking all of the custom nodes and extensions I install. I had kind of assumed that this community wasn't going to be like that, but apparently some people are like that.

F*** that guy. 
